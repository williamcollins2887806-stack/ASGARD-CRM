# ASGARD CRM - ПОЛНАЯ ДОКУМЕНТАЦИЯ СИСТЕМЫ

**Версия:** 2.0
**Дата:** 03.02.2026
**Назначение:** Руководство пользователя и техническая документация

---

## ОГЛАВЛЕНИЕ

1. [Общее описание системы](#1-общее-описание-системы)
2. [Роли и права доступа](#2-роли-и-права-доступа)
3. [Структура навигации](#3-структура-навигации)
4. [Бизнес-процессы](#4-бизнес-процессы)
5. [Формы и модальные окна](#5-формы-и-модальные-окна)
6. [Интеграции](#6-интеграции)
7. [Специальные функции](#7-специальные-функции)
8. [Схема базы данных](#8-схема-базы-данных)

---

# 1. ОБЩЕЕ ОПИСАНИЕ СИСТЕМЫ

## 1.1 Назначение

**АСГАРД CRM** — комплексная система управления тендерами, работами и персоналом для компании "АСГАРД-СЕРВИС". Система обеспечивает полный цикл управления контрактами от поиска тендеров до закрытия работ.

## 1.2 Основные возможности

- **Управление тендерами** — поиск, регистрация, распределение, просчёт
- **Управление работами** — планирование, выполнение, отчётность
- **Управление персоналом** — карточки сотрудников, бронирование, рейтинги
- **Финансовый учёт** — расходы, доходы, счета, акты
- **Документооборот** — договоры, корреспонденция, доверенности
- **AI-ассистент Мимир** — умный помощник на основе YandexGPT
- **Интеграции** — Telegram, Mango телефония, банковский импорт

## 1.3 Технический стек

| Компонент | Технология |
|-----------|------------|
| Backend | Node.js + Fastify |
| Database | PostgreSQL |
| Frontend | Vanilla JavaScript (SPA) |
| Offline | IndexedDB |
| AI | YandexGPT |

---

# 2. РОЛИ И ПРАВА ДОСТУПА

## 2.1 Список ролей

| Код роли | Название | Описание |
|----------|----------|----------|
| `ADMIN` | Администратор | Полный доступ ко всем функциям |
| `PM` | Руководитель проекта | Управление своими тендерами и работами |
| `TO` | Тендерный отдел | Регистрация и подготовка тендеров |
| `HR` | Кадры | Управление персоналом |
| `BUH` | Бухгалтерия | Финансовый учёт, счета, акты |
| `OFFICE_MANAGER` | Офис-менеджер | Офисные расходы, корреспонденция |
| `WAREHOUSE` | Склад | Оборудование и материалы |
| `DIRECTOR_COMM` | Коммерческий директор | Согласование ТКП, распределение тендеров |
| `DIRECTOR_GEN` | Генеральный директор | Полный доступ + стратегические решения |
| `DIRECTOR_DEV` | Директор по развитию | Аналитика, KPI, стратегия |
| `PROC` | Закупки | Управление закупками |

## 2.2 Матрица прав доступа

| Функция | ADMIN | PM | TO | HR | BUH | DIRECTOR |
|---------|-------|----|----|----|----|----------|
| Тендеры (чтение) | ✅ | ✅ | ✅ | ❌ | ❌ | ✅ |
| Тендеры (создание) | ✅ | ❌ | ✅ | ❌ | ❌ | ✅ |
| Тендеры (распределение) | ✅ | ❌ | ❌ | ❌ | ❌ | ✅ |
| Работы (чтение) | ✅ | ✅ | ❌ | ❌ | ✅ | ✅ |
| Работы (управление) | ✅ | ✅ | ❌ | ❌ | ❌ | ✅ |
| Персонал | ✅ | ⚠️ | ❌ | ✅ | ❌ | ✅ |
| Финансы | ✅ | ⚠️ | ❌ | ❌ | ✅ | ✅ |
| Настройки | ✅ | ❌ | ❌ | ❌ | ❌ | ✅ |
| AI Мимир | ✅ | ⚠️ | ⚠️ | ⚠️ | ⚠️ | ✅ |

**Легенда:** ✅ Полный доступ | ⚠️ Ограниченный доступ | ❌ Нет доступа

---

# 3. СТРУКТУРА НАВИГАЦИИ

## 3.1 Главное меню

### Блок "Тендеры и продажи"
| Пункт | Маршрут | Роли | Описание |
|-------|---------|------|----------|
| Тендеры | `#/tenders` | TO, ADMIN, DIRECTOR | Реестр тендеров |
| Просчёты РП | `#/pm-calcs` | PM, ADMIN, DIRECTOR | Расчёты ТКП |
| Согласования | `#/approvals` | DIRECTOR, ADMIN | Очередь согласования ТКП |
| Follow-up ТКП | `#/tkp-followup` | PM, DIRECTOR, ADMIN | Отслеживание отправленных ТКП |
| Воронка | `#/funnel` | DIRECTOR, ADMIN | Воронка продаж |

### Блок "Работы"
| Пункт | Маршрут | Роли | Описание |
|-------|---------|------|----------|
| Мои работы | `#/pm-works` | PM, ADMIN | Работы руководителя проекта |
| Все работы | `#/all-works` | DIRECTOR, ADMIN | Общий список работ |
| Все сметы | `#/all-estimates` | DIRECTOR, ADMIN | Реестр смет |
| KPI работы | `#/kpi-works` | DIRECTOR, ADMIN | Показатели по работам |
| KPI деньги | `#/kpi-money` | DIRECTOR, ADMIN | Финансовые показатели |

### Блок "Персонал"
| Пункт | Маршрут | Роли | Описание |
|-------|---------|------|----------|
| Сотрудники | `#/personnel` | HR, ADMIN, DIRECTOR | Карточки сотрудников |
| График рабочих | `#/workers-schedule` | HR, PM, ADMIN | Календарь занятости |
| График офиса | `#/office-schedule` | ALL | Офисный календарь |
| Заявки HR | `#/hr-requests` | HR, ADMIN | Запросы персонала |
| Рейтинг HR | `#/hr-rating` | HR, DIRECTOR, ADMIN | Рейтинги сотрудников |
| Дни рождения | `#/birthdays` | ALL | Календарь ДР |

### Блок "Финансы"
| Пункт | Маршрут | Роли | Описание |
|-------|---------|------|----------|
| Финансы | `#/finances` | BUH, DIRECTOR, ADMIN | Общая финансовая панель |
| Счета | `#/invoices` | BUH, PM, DIRECTOR | Реестр счетов |
| Акты | `#/acts` | BUH, PM, DIRECTOR | Акты выполненных работ |
| Расходы офиса | `#/office-expenses` | OFFICE_MANAGER, BUH, ADMIN | Офисные расходы |
| Командировки | `#/travel` | PM, BUH, ADMIN | Командировочные расходы |
| Импорт банка | `#/bank-import` | BUH, ADMIN | Импорт выписок |
| Реестр БУХ | `#/buh-registry` | BUH, ADMIN | Бухгалтерский реестр |

### Блок "Документы"
| Пункт | Маршрут | Роли | Описание |
|-------|---------|------|----------|
| Контрагенты | `#/customers` | ALL | База контрагентов |
| Договоры | `#/contracts` | BUH, DIRECTOR, ADMIN | Реестр договоров |
| Корреспонденция | `#/correspondence` | OFFICE_MANAGER, ADMIN | Входящая/исходящая почта |
| Доверенности | `#/proxies` | OFFICE_MANAGER, ADMIN | Реестр доверенностей |
| Печати | `#/seals` | OFFICE_MANAGER, ADMIN | Учёт печатей |

### Блок "Инструменты"
| Пункт | Маршрут | Роли | Описание |
|-------|---------|------|----------|
| Дашборд | `#/dashboard` | ALL | Главная панель |
| Отчёты | `#/reports` | DIRECTOR, ADMIN | Автоматические отчёты |
| Склад | `#/warehouse` | WAREHOUSE, ADMIN | Учёт оборудования |
| Уведомления | `#/alerts` | ALL | Журнал уведомлений |
| Настройки | `#/settings` | ADMIN, DIRECTOR | Конфигурация системы |

---

# 4. БИЗНЕС-ПРОЦЕССЫ

## 4.1 Жизненный цикл тендера

```
┌─────────────────────────────────────────────────────────────────┐
│                    ЖИЗНЕННЫЙ ЦИКЛ ТЕНДЕРА                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────┐    ┌──────────────┐    ┌─────────────────────┐   │
│  │  Новый   │───▶│На распред.   │───▶│ Отправлено на       │   │
│  │   (ТО)   │    │  (DIRECTOR)  │    │ просчёт (PM)        │   │
│  └──────────┘    └──────────────┘    └─────────────────────┘   │
│                                                 │               │
│                                                 ▼               │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐      │
│  │   Клиент     │◀───│  ТКП         │◀───│ТКП отправлено│      │
│  │  согласился  │    │ согласовано  │    │(на согласов.)│      │
│  └──────────────┘    └──────────────┘    └──────────────┘      │
│         │                                                       │
│         ▼                                                       │
│  ┌──────────────┐                                               │
│  │  КОНТРАКТ    │  ← Создание работы                            │
│  │  (Выиграли)  │                                               │
│  └──────────────┘                                               │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Этапы тендера

| # | Статус | Ответственный | Действия |
|---|--------|---------------|----------|
| 1 | **Новый** | ТО | Регистрация тендера, заполнение данных |
| 2 | **На распределении** | DIRECTOR | Назначение РП |
| 3 | **Отправлено на просчёт** | PM | Расчёт ТКП через калькулятор |
| 4 | **ТКП отправлено** | PM | Отправка на согласование |
| 5 | **Согласование ТКП** | DIRECTOR | Проверка и утверждение |
| 6 | **ТКП согласовано** | PM | Отправка заказчику |
| 7 | **Клиент согласился** | PM | Подписание контракта |
| 8 | **Контракт/Выиграли** | PM | Создание работы |

### Альтернативные исходы
- **Клиент отказался** — ТКП не принято
- **Проиграли** — Конкурент выиграл тендер
- **Отменено** — Тендер отменён заказчиком

---

## 4.2 Жизненный цикл работы

```
┌─────────────────────────────────────────────────────────────────┐
│                    ЖИЗНЕННЫЙ ЦИКЛ РАБОТЫ                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐      │
│  │ Подготовка   │───▶│   В работе   │───▶│  Подписание  │      │
│  │    (PM)      │    │    (PM)      │    │    акта      │      │
│  └──────────────┘    └──────────────┘    └──────────────┘      │
│                                                 │               │
│                                                 ▼               │
│                      ┌──────────────┐    ┌──────────────┐      │
│                      │   Закрыто    │◀───│ Работы сдали │      │
│                      │  (DIRECTOR)  │    │    (PM)      │      │
│                      └──────────────┘    └──────────────┘      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Этапы работы

| # | Статус | Ответственный | Действия |
|---|--------|---------------|----------|
| 1 | **Подготовка** | PM | Создание работы из тендера, планирование |
| 2 | **В работе** | PM | Выполнение, учёт расходов, ФОТ |
| 3 | **Подписание акта** | PM | Подготовка документов на закрытие |
| 4 | **Работы сдали** | PM | Ввод фактических данных, оценка персонала |
| 5 | **Закрыто** | DIRECTOR | Утверждение завершения |

### Закрытие работы (closeout)

При закрытии работы обязательно:
1. Ввести фактические даты (начало/конец)
2. Указать фактическую себестоимость
3. Указать полученные платежи
4. **Оценить каждого сотрудника (1-10)** с комментарием
5. **Оценить заказчика (1-10)** с комментарием

---

## 4.3 Workflow согласования ТКП

```
┌─────────────────────────────────────────────────────────────────┐
│                   СОГЛАСОВАНИЕ ТКП                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│    PM создаёт estimate          DIRECTOR в #/approvals          │
│           │                              │                      │
│           ▼                              ▼                      │
│    ┌──────────────┐              ┌──────────────┐              │
│    │ Отправить на │─────────────▶│  Просмотр    │              │
│    │ согласование │              │    ТКП       │              │
│    └──────────────┘              └──────────────┘              │
│                                          │                      │
│                         ┌────────────────┼────────────────┐     │
│                         ▼                ▼                ▼     │
│                  ┌──────────┐    ┌──────────┐    ┌──────────┐  │
│                  │Согласовать│   │ Доработка │   │  Вопрос  │  │
│                  │    ✓     │    │     ✕     │    │    ?    │  │
│                  └──────────┘    └──────────┘    └──────────┘  │
│                         │                │                │     │
│                         ▼                ▼                ▼     │
│                  ┌──────────┐    ┌──────────┐    ┌──────────┐  │
│                  │ approved │    │  rework  │    │ question │  │
│                  │  (готово)│    │(на доработ)│  │ (QA чат) │  │
│                  └──────────┘    └──────────┘    └──────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Зоны прибыльности (визуальная индикация)

| Зона | Прибыль/чел-день | Цвет |
|------|------------------|------|
| 🟢 Зелёная | ≥ 25,000 ₽ | Хорошо |
| 🟡 Жёлтая | 20,000 — 24,999 ₽ | Внимание |
| 🔴 Красная | < 20,000 ₽ | Убыток |

---

## 4.4 Согласование премий

```
PM → Запрос премии → bonus_request (status: pending)
                            │
                            ▼
              DIRECTOR в #/bonus-approval
                            │
              ┌─────────────┼─────────────┐
              ▼             ▼             ▼
         ┌────────┐   ┌────────┐   ┌────────┐
         │Одобрить│   │Отклонить│  │Вопрос │
         └────────┘   └────────┘   └────────┘
              │             │             │
              ▼             ▼             ▼
         approved      rejected      question
         (→ создаёт    (→ notify PM) (→ ждёт ответа)
         work_expenses)
```

---

## 4.5 Управление расходами

### Категории расходов по работам

| Категория | Код | Описание |
|-----------|-----|----------|
| 👷 ФОТ | `fot` | Зарплата, командировочные, премии |
| 🚚 Логистика | `logistics` | Доставка, транспорт |
| 🏨 Проживание | `accommodation` | Гостиницы, квартиры |
| 🚗 Трансфер | `transfer` | Такси, ж/д билеты |
| 🧪 Химия | `chemicals` | Химические реагенты |
| 🔧 Оборудование | `equipment` | Аренда/покупка оборудования |
| 🤝 Субподряд | `subcontract` | Услуги субподрядчиков |
| 📦 Прочее | `other` | Другие расходы |

### Категории офисных расходов

| Категория | Код | Описание |
|-----------|-----|----------|
| 🏢 Аренда | `rent` | Аренда офиса |
| 💡 Коммунальные | `utilities` | Электричество, вода, отопление |
| 📎 Канцелярия | `office_supplies` | Бумага, ручки и т.д. |
| 📡 Связь | `communication` | Интернет, телефония |
| 🚕 Транспорт | `transport` | Такси, парковка |
| 🧹 Хозтовары | `household` | Уборка, расходники |
| 🖥️ Оборудование | `office_equipment` | Компьютеры, мебель |
| 💿 ПО | `software` | Лицензии, подписки |
| 🎁 Представительские | `representation` | Подарки, мероприятия |
| 📦 Прочее | `other` | Другие расходы |

---

# 5. ФОРМЫ И МОДАЛЬНЫЕ ОКНА

## 5.1 Форма создания/редактирования тендера

**Маршрут:** `#/tenders` → Кнопка "+" или клик на строку

### Основные поля

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| Период (YYYY-MM) | Text | ✅ | Месяц тендера |
| ИНН заказчика | Text | ⚠️ | 10 или 12 цифр |
| Заказчик | Text + datalist | ✅ | Название организации |
| Тендер/закупка | Text | ✅ | Название тендера |
| Тип заявки | Select | ✅ | Тендер, Запрос предложений, и т.д. |
| Ответственный РП | Select | ⚠️ | PM (при статусе > Новый) |
| Статус | Select | — | Из справочника |
| Сумма | Number | — | Ориентировочная цена |
| Дедлайн | Date | ⚠️ | Для типов != "Прямой запрос" |
| Комментарий ТО | Text | — | Примечания |

### Кнопки действий

| Кнопка | Доступна | Действие |
|--------|----------|----------|
| Сохранить | Всегда | Сохранить изменения |
| На распределение | ТО | Отправить директорам |
| Передать в просчёт | DIRECTOR | Назначить РП |
| Загрузить файл | PM, ТО | Прикрепить документ |
| Переназначить РП | DIRECTOR | Сменить РП с причиной |
| История | DIRECTOR, ADMIN | Аудит изменений |

---

## 5.2 Калькулятор просчёта v2

**Назначение:** Расчёт себестоимости и цены ТКП

### Вкладки калькулятора

#### 1. Объект
- Тип работы (выбор из справочника)
- Город
- Расстояние от Москвы (км)
- Условия работы (чекбоксы)
- Допущения и риски

#### 2. Параметры
- Площадь/объём/длина (зависит от типа работы)
- Кнопка "🤖 Автоподбор" — автозаполнение

#### 3. Бригада
- Таблица: Роль | Кол-во | Ставка
- Доплаты (чекбоксы)

#### 4. Сроки
- Подготовка (дни)
- Работа (дни)
- Демобилизация (дни)

#### 5. Химия
- Таблица: Состав | Кг | Цена | Сумма

#### 6. Оборудование
- Таблица: Позиция | Кол. | Тип | Ставка/сут

#### 7. Логистика
- Транспорт (авто/выбор)
- Проживание
- Мобилизация

#### 8. Итоги
- **Себестоимость:** ФОТ, суточные, проживание, логистика, химия, оборудование
- **Цена:** с маржой, НДС
- **Прибыль:** чистая, на человека в день

---

## 5.3 Форма закрытия работы

**Триггер:** Кнопка "Работы завершены" в #/pm-works

### Шаг 1: Фактические данные

| Поле | Обязательное |
|------|--------------|
| Старт работ (факт) | — |
| Окончание работ (факт) | ✅ |
| Себестоимость (факт) | ✅ |
| Актуальная цена контракта | ✅ |
| Аванс получено | — |
| Дата аванса | — |
| Остаток получено | — |
| Дата оплаты остатка | — |

### Шаг 2: Оценка персонала

Для **каждого сотрудника** на работе:
- Оценка (1-10) — **обязательно**
- Комментарий — **обязательно**

### Шаг 3: Оценка заказчика

- Оценка (1-10) — **обязательно**
- Комментарий — **обязательно**

---

## 5.4 Карточка сотрудника

**Маршрут:** `#/employee?id=XXX`

### Секции карточки

#### Основная информация
- ФИО, дата рождения, пол
- Должность, разряд
- Дата приёма

#### Документы
- Паспорт (серия, номер, кем выдан, дата, код)
- ИНН, СНИЛС
- Военный билет
- Водительское удостоверение

#### Контакты
- Адрес регистрации
- Фактический адрес
- Телефон основной/дополнительный
- Email, Telegram

#### Экстренные контакты
- Супруг(а): ФИО, телефон
- Родственник: ФИО, кем приходится, телефон

#### Дополнительно
- Образование, специальность
- Семейное положение, дети
- Размеры одежды/обуви
- Рост, группа крови
- Аллергии/мед. ограничения

#### Допуски и разрешения
- Чекбоксы из справочника

#### История работ
- Таблица: С | По | Контракт | Роль

#### Отзывы РП
- Таблица: Объект | Дата | Оценка | Комментарий

---

## 5.5 Форма счёта/акта

### Поля

| Поле | Тип | Описание |
|------|-----|----------|
| Номер | Text | Автогенерация или ручной ввод |
| Дата | Date | По умолчанию: сегодня |
| Контрагент | Select | Из справочника customers |
| Привязка к работе | Select | Опционально |
| Сумма | Number | Без НДС |
| НДС % | Number | По умолчанию: 20% |
| Примечание | Textarea | Условия оплаты и т.д. |

### Статусы счёта

| Статус | Код | Описание |
|--------|-----|----------|
| ⏳ Ожидает | `pending` | Создан, не оплачен |
| 🟡 Частично | `partial` | Частичная оплата |
| ✅ Оплачен | `paid` | Полностью оплачен |
| ✕ Отменён | `cancelled` | Отменён |

### Статусы акта

| Статус | Код | Описание |
|--------|-----|----------|
| 📝 Черновик | `draft` | Создан |
| 📤 Отправлен | `sent` | Отправлен клиенту |
| ✍️ Подписан | `signed` | Клиент подписал |
| ✅ Оплачен | `paid` | Получена оплата |

---

# 6. ИНТЕГРАЦИИ

## 6.1 Telegram

**Назначение:** Уведомления и команды через Telegram-бота

### Возможности
- Привязка аккаунта через `/link email@example.com`
- Уведомления о событиях (тендеры, премии, дедлайны)
- Отправка временных паролей
- Парсинг банковских SMS

### Команды бота

| Команда | Описание |
|---------|----------|
| `/start` | Начало работы |
| `/link email` | Привязка аккаунта CRM |
| `/status` | Статистика системы |
| `/my` | Мои активные задачи |
| `/help` | Справка |

### Конфигурация

```
TELEGRAM_BOT_TOKEN = "токен:XXXXX"
```

---

## 6.2 Mango Telecom (телефония)

**Назначение:** IP-телефония, журнал звонков, Click-to-Call

### Возможности
- Переключатель приёма звонков
- Карточка входящего с данными контрагента
- История звонков
- Исходящие звонки из CRM

### Конфигурация

```json
{
  "api_key": "ключ",
  "api_salt": "секрет",
  "vpbx_host": "vpbx123456",
  "enabled": true
}
```

---

## 6.3 Email (SMTP)

**Назначение:** Отправка деловых писем

### Возможности
- Шаблоны: ТКП, Счёт, Акт, Напоминание
- Вложения (PDF, документы)
- История отправок
- Тестовая отправка

### Конфигурация

```
SMTP_HOST = "smtp.example.com"
SMTP_PORT = 587
SMTP_USER = "username"
SMTP_PASS = "password"
SMTP_FROM = "АСГАРД CRM <noreply@domain.ru>"
```

---

## 6.4 Синхронизация (IndexedDB ↔ PostgreSQL)

**Назначение:** Офлайн-режим и синхронизация данных

### Возможности
- Двунаправленная синхронизация
- Инкрементальная по `updated_at`
- Разрешение конфликтов (server wins)
- Автосинхронизация каждые N минут

### Синхронизируемые таблицы (20 таблиц)
`users, tenders, estimates, works, employees, employee_assignments, employee_reviews, work_expenses, office_expenses, customers, contracts, seals, bonus_requests, correspondence, proxies, calendar_events, notifications, documents, audit_log`

---

## 6.5 Импорт банковских выписок

**Назначение:** Автоматический импорт транзакций из CSV

### Возможности
- Парсинг CSV/TXT любых форматов
- Защита от дублей (хеширование)
- Авторазнесение по ключевым словам
- Обучение системы

### Поддерживаемые банки
- Сбербанк
- Альфа-Банк
- Тинькофф

---

## 6.6 YandexGPT (AI Мимир)

**Назначение:** Искусственный интеллект для помощи пользователям

### Возможности
- Чат с ИИ (виджет)
- Поиск по тендерам, работам, сотрудникам
- Финансовая аналитика
- Рекомендации по тендерам
- Генерация ТКП

### Конфигурация

```
YANDEX_FOLDER_ID = "b1gxxxxxxxx"
YANDEX_API_KEY = "ключ"
```

---

# 7. СПЕЦИАЛЬНЫЕ ФУНКЦИИ

## 7.1 Мимир — AI-ассистент

**Горячие клавиши:** Нет (кнопка 🧙 в правом нижнем углу)

### Возможности
- Вопросы на естественном языке
- Загрузка файлов для анализа
- Быстрые команды: Статистика, Просрочки, Дедлайны, Создать ТКП
- Ограничения по ролям

### Примеры запросов
- "Покажи статистику по тендерам"
- "Какие счета просрочены?"
- "Найди работы по Газпрому"
- "Помоги с ТКП"

---

## 7.2 Сканер чеков

**Назначение:** Распознавание чеков с камеры

### Возможности
- Фото с камеры или загрузка изображения
- OCR через Tesseract.js
- Автозаполнение: сумма, дата, магазин, ИНН
- Привязка к работе

### Как использовать
1. Нажмите 📷 Сканер чеков
2. Разрешите доступ к камере
3. Сфотографируйте чек
4. Проверьте распознанные данные
5. Сохраните расход

---

## 7.3 Глобальный поиск

**Горячие клавиши:** `Ctrl+K` / `Cmd+K`

### Возможности
- Поиск по всем разделам
- Фильтрация по категориям
- История поиска
- Клавиатурная навигация

### Категории поиска
- 📋 Тендеры
- 🔧 Работы
- 🏢 Клиенты
- 👤 Сотрудники
- 💰 Счета
- 📄 Акты

---

## 7.4 Экспорт данных

**Форматы:** CSV (совместим с Excel)

### Доступные экспорты
- Тендеры (с фильтрами)
- Работы
- Расходы по работам
- Офисные расходы
- Командировочные
- Сотрудники
- Пользователи
- Корреспонденция
- Сводный отчёт дашборда

---

## 7.5 QR-коды

**Назначение:** Быстрый доступ к сущностям

### Возможности
- Генерация QR для тендеров, работ, сотрудников
- Печать QR
- Сканирование QR с камеры
- Batch-печать списков

---

## 7.6 Диаграммы Гантта

**Назначение:** Визуализация сроков проектов

### Возможности
- Мини-версия (16 недель)
- Полная доска (52 недели)
- Цветовая кодировка статусов
- Интерактивные бары

---

## 7.7 Автоматические отчёты

**Расписание:**
- **1 числа месяца** — месячный отчёт
- **1 апреля/июля/октября** — квартальный отчёт
- **1 января** — годовой отчёт

### Содержание отчёта
- Количество тендеров (всего, выиграно, проиграно)
- Количество работ (всего, завершено)
- Доходы и расходы
- Прибыль
- Топ-5 заказчиков

---

## 7.8 Уведомления

**Каналы:** Сайт + Telegram

### Типы уведомлений
- 💰 Премии (создание/согласование/отклонение)
- 👥 Персонал (запросы)
- 🛒 Закупки
- 📋 Тендеры (передача)
- 💬 Сообщения (чат)
- 📊 Отчёты (готовность)

---

# 8. СХЕМА БАЗЫ ДАННЫХ

## 8.1 Основные таблицы

### users — Пользователи
```sql
id, login, email, password_hash, name, role,
telegram_chat_id, is_active, created_at, updated_at
```

### tenders — Тендеры
```sql
id, period, customer_inn, customer_name, tender_title,
tender_type, tender_status, responsible_pm_id,
deadline, sum_value, distribution_requested_at,
handoff_at, handoff_by_user_id, created_at, updated_at
```

### estimates — Просчёты ТКП
```sql
id, tender_id, version, cost_plan, price_tkp,
calc_summary_json, calc_v2_json, approval_status,
sent_for_approval_at, approved_at, rework_requested_at,
created_at, updated_at
```

### works — Работы
```sql
id, tender_id, pm_id, work_number, work_title,
customer_name, work_status, contract_value,
start_in_work_date, end_plan, end_fact,
cost_plan, cost_fact, advance_pct, advance_received,
advance_date_fact, balance_received, payment_date_fact,
closeout_submitted_at, closed_at, created_at, updated_at
```

### employees — Сотрудники
```sql
id, fio, birth_date, role_tag, city, phone,
passport_series, passport_number, inn, snils,
address_reg, address_fact, email, telegram,
rating_avg, is_active, deleted, created_at, updated_at
```

### employee_reviews — Отзывы о сотрудниках
```sql
id, employee_id, pm_id, work_id, rating, comment,
created_at
```

### employee_plan — График занятости
```sql
id, employee_id, date, status, work_id, comment,
created_at
```

### work_expenses — Расходы по работам
```sql
id, work_id, category, amount, date, comment,
supplier, doc_number, invoice_needed, invoice_received,
fot_employee_id, fot_base_pay, fot_per_diem, fot_bonus,
created_at
```

### office_expenses — Офисные расходы
```sql
id, category, amount, date, counterparty, description,
status, created_by, created_at
```

### customers — Контрагенты
```sql
id, inn, name, full_name, kpp, ogrn, address,
phone, email, comment, created_at, updated_at
```

### contracts — Договоры
```sql
id, number, type, counterparty_id, counterparty_name,
subject, amount, start_date, end_date, is_perpetual,
status, notes, created_at
```

### invoices — Счета
```sql
id, invoice_number, invoice_date, customer_id,
customer_name, work_id, amount, vat_pct, total_amount,
paid_amount, notes, status, created_at
```

### acts — Акты
```sql
id, act_number, act_date, customer_id, customer_name,
work_id, amount, vat_pct, total_amount, notes,
status, signed_date, created_at
```

### bonus_requests — Запросы премий
```sql
id, work_id, status, bonuses_json, comment,
created_by, approved_by, created_at, processed_at
```

### notifications — Уведомления
```sql
id, user_id, title, message, link, type,
is_read, created_at
```

### audit_log — Журнал аудита
```sql
id, user_id, entity_type, entity_id, action,
payload_json, created_at
```

### settings — Настройки
```sql
id, key, value_json, updated_at
```

---

## 8.2 Связи между таблицами

```
tenders ──────────────────┐
    │                     │
    ▼                     ▼
estimates              works
    │                     │
    │                     ├──▶ work_expenses
    │                     ├──▶ employee_assignments
    │                     └──▶ bonus_requests
    │
    └──▶ approvals (Q&A)

employees ────────────────┐
    │                     │
    ├──▶ employee_reviews │
    ├──▶ employee_plan    │
    └──▶ employee_permits │
                          │
customers ────────────────┤
    │                     │
    ├──▶ contracts        │
    ├──▶ invoices         │
    └──▶ acts             │
                          │
users ────────────────────┘
    │
    ├──▶ notifications
    └──▶ audit_log
```

---

# ПРИЛОЖЕНИЯ

## A. Справочник статусов тендеров

```
Новый
На распределении
Отправлено на просчёт
ТКП отправлено
Согласование ТКП
ТКП согласовано
Клиент согласился
Клиент отказался
Выиграли
Проиграли
Контракт
Отменено
```

## B. Справочник статусов работ

```
Подготовка
В работе
Подписание акта
Работы сдали
Закрыто
Приостановлено
Отменено
```

## C. Типы тендеров

```
Тендер
Запрос предложений
Оценка рынка
Прямой запрос
Доп. объём
```

## D. Горячие клавиши

| Клавиша | Действие |
|---------|----------|
| `Ctrl+K` / `Cmd+K` | Глобальный поиск |
| `Esc` | Закрыть модальное окно |
| `↑` `↓` | Навигация в поиске |
| `Enter` | Выбрать в поиске |

---

**Документация подготовлена:** Claude (AI)
**Дата:** 03.02.2026
**Версия документа:** 1.0
